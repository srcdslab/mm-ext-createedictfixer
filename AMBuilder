# vim: set sts=2 ts=8 sw=2 tw=99 et ft=python:
import os

projectName = 'createedictfixer'

for cxx in builder.targets:
  for sdk_name in SM.sdks:
    sdk = SM.sdks[sdk_name]

    if not cxx.target.arch in sdk.platformSpec[cxx.target.platform]:
      continue

    binary = SM.HL2Library(builder, cxx, projectName + '_mm_i486', sdk)

    binary.compiler.defines += [
      'HAVE_STRING_H',
    ]

    if cxx.target.platform == 'linux':
      cxx.postlink += ['-lpthread', '-lrt']
    elif cxx.target.platform == 'mac':
      cxx.cflags += ['-Wno-deprecated-declarations']
      cxx.postlink += ['-framework', 'CoreServices']

    if cxx.family == 'gcc' or cxx.family == 'clang':
      cxx.cxxflags += ['-fno-rtti']
    elif cxx.family == 'msvc':
      cxx.cxxflags += ['/GR-']

    binary.sources += [
      'cef.cpp',
      os.path.join(SM.mms_root, 'extensions', 'sm-ext-common', 'mathstubs.c'),
    ]

    SM.extensions += [builder.Add(binary)]
